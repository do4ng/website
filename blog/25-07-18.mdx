Get ready for a performance boost of epic proportions! We are thrilled to introduce a game-changing overhaul of how Zely handles files, starting with **v4.0.3**: a brand new **hybrid FileSystem**. Our primary goal with this innovation is to deliver lightning-fast file loading and a smoother development experience.

## A Hybrid FileSystem

Traditionally, Zely (like most frameworks) employed the default `node:fs` for all file access. Solid but constantly hitting the disk can be a performance bottleneck. So we've crafted an intelligent, two-pronged approach:

The new Zely FileSystem intelligently combines an **in-memory virtual filesystem** with the traditional **physical disk filesystem (`node:fs`)**.

**Here's the idea:**

We optimize for the **in-memory filesystem** for speed. This means that frequently used files, or recently created files, are directly in your application's memory and can be retrieved in near-instant time.

But what if you have many files? We've got this covered. To prevent the use of too much memory, the system will **automatically fall back to the disk filesystem** when a certain point is reached. As of **4.0.3-beta.0**, this point is **5,000 files**.

**Let's look at an example:**

If your in-memory filesystem has a `max file count` of 3 and is already holding `1.txt`, `2.txt`, and `3.txt`. If `1.txt` was the least recently modified file and `3.txt` the most recently modified, and a new file, `4.txt`, tries to enter memory:

The system will realize that adding `4.txt` would exceed the `max file count`. To make room, it intelligently finds and moves the least recently used file (`1.txt` in this case) from memory to disk. `4.txt` can then be read into memory without a hitch. This optimizes memory usage while keeping frequently accessed files readily available.

## Performance

We've been optimizing relentlessly, and the numbers from our [benchmark repository](https://github.com/zely-js/benchmark-history) are very promising. Here's a summary of the gains:

- **Latency:** From **0.14 ms to 0.1 ms** – that's a significant **28.57% reduction**!
- **Requests per Second:** From **13.7K to 14.7K** – a decent **7.30% increase**.
- **Bytes per Second:** From **1.66 MB to 1.78 MB** – a decent **7.23% increase**.

These numbers translate to a much snappier and more responsive Zely app for you and your users.

---

### Limitations

Keep in mind that this hybrid filesystem is experimental. We're monitoring and testing its performance closely, attempting to learn all of its advantages as well as potential limitations. Although the gains in speed are definitely real, we're still looking into things like long-term memory management to ensure rock-solid stability.

For the users who might prefer the established disk-based filesystem, you can continue to use **Zely v4.0.2 and earlier**.

We're all pretty stoked about what this new FileSystem will mean for the future of Zely. We believe it will pave the way for even more performant and scalable applications.
